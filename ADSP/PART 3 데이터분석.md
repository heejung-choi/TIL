
# PART 3 데이터분석

# 2장 R 프로그래밍 기초

-  R의 데이터 구조 중 벡터에 대한 설명으로 적절한 것은?

    - 벡터는 하나의 스칼라 값 또는 하나 이상의 스칼라 원소들을 갖는 단순한 형태의 집합이다.

- 벡터와 리스트의 차이

    - 벡터: 여러개의 원소를 가지는 하나의 변수로 한 벡터의 모든 원소는 같은 자료형 또는 모드를 가진다.

    - 리스트: 다른 프로그래밍 언어에서 사전, 해시, 탐색표와 유사하며 R에서는 리스트를 인덱싱 할 수 있는 장점을 가지고 있다. 또한 리스트는 여러 자료형의 원소들이 포함 될 수 있다.

 - R의 Summary 함수
 
    - 연속형 변수의 경우 4분위수, 최소값, 최대값, 중앙값, 평균 등을 출력하고 범주형 변수의 경우 각 범주에 대한 빈도수를 출력하여 데이터의 분포를 파악할 수 있게 한다. 또한 수치형 변수의 경우 최대값, 최소값, 평균, 1사분위수, 2사분위수(중앙값), 3사분위수를 출력하며 명목형변수의 경우 명목값, 데이터의 개수를 출력하는 함수이다.   

- R의 데이터구조 중 2차원 목록 데이터 구조이면서 각 열이 서로 다른 데이터 타입을 가질 수 있는 데이터 구조는?
    - 데이터프레임: 데이터프레임은 표 형태의 데이터 구조이며, 각 열은 서로 다른 데이터 형식을 가질 수 없다.

- 해당 코드가 의미하는 것은?
    - mean(x, na.rm=T) : na.rm은 결측치를 제외하느냐에 대한 물음이며, T는 TRUE로 결측치를 제외하겠다는 의미이다.

## R에서 사용하는 데이터 set의 형태

### 벡터(vector)
R은 실수, 복소수, 문자열, 논리값 등의 기본 데이터를 하나씩 단독으로 다루는 것이 아니라 같은 종류의 데이터를 여러개 묶은 벡터 형식으로 다룬다. 벡터를 만드는 가장 간단한 방법은 함수 c()를 이용하는 방법이다. 함수 c()의 인수 값으로 벡터에 넣고 싶은 값들을 열거하면 목적하는 벡터를 만들 수 있다.

``` > 
벡터의 작성
> v <- c("abc", 12, 0.456, TRUE)
> v
```

### 행렬(matrix)
벡터는 원소를 단지 1열로 열거해놓은 것 뿐이지만, 실제 데이터는 행과 열로 이루어진 표 형식을 따르는 것이 많다. 이러한 데이터 형식을 R에서는 행렬이라 하고, 표 형식의 데이터에 대한 분석함수를 이용하기 위해서는 미리 행렬화 시킬 필요가 있다. 행렬은 함수 matrix()를 이용해 바탕이 되는 벡터에 행의 수 혹은 열의 수에 대한 정보를 추가함으로써 만들 수 있다.

```
5부터 60까지 5씩 증가하는 정수벡터 작성 
v <- seq(5, 60, by = 5)
v
>  [1]  5 10 15 20 25 30 35 40 45 50 55 60

 열의 수가 4인 행렬 
matrix(v, ncol = 4)
>      [,1] [,2] [,3] [,4]
> [1,]    5   20   35   50
> [2,]   10   25   40   55
> [3,]   15   30   45   60
```

### 리스트(list)
리스트는 벡터나 행렬을 한꺼번에 취급할 수 있는 형식이다. 복수의 관련된 벡터나 행렬을 하나의 리스트에 정리하여 보존할 수 있으며 함수 list()를 이용하여 작성합니다. 함수의 인수 값은 리스트에 포함되는 벡터나 행렬을 지정하거나, 데이터의 참조용 이름을 부여하여 사용할 수도 있다.

```
(3,2,1)을 3번 반복하는 벡터 작성 
myvector <- rep(c(3, 2, 1), 3)
myvector
> [1] 3 2 1 3 2 1 3 2 1

mymatrix <- matrix(1:12, ncol = 4) 
mymatrix
>      [,1] [,2] [,3] [,4]
> [1,]    1    4    7   10
> [2,]    2    5    8   11
> [3,]    3    6    9   12

 mylist <- list(dataA = myvector, dataB = mymatrix) 
 mylist
> $dataA
> [1] 3 2 1 3 2 1 3 2 1
> 
> $dataB
>      [,1] [,2] [,3] [,4]
> [1,]    1    4    7   10
> [2,]    2    5    8   11
> [3,]    3    6    9   12
```

### 데이터프레임(data frame)
데이터프레임은 R에서 분석을 수행할 때 가장 빈번히 사용되는 형식이다. 외부파일로부터 R에 데이터를 불러올 때 사용하는 함수 군은 불러들인 데이터를 모두 데이터프레임으로 변환시키기 때문이다. 데이터프레임은 리스트의 한 종류로 리스트에 포함된 모든 값이 길이가 같은 벡터일 때, 혹은 행의 수, 열의 수가 같은 행렬에 한해 그 리스트를 함수 data.frame()을 이용해 데이터프레임으로 변환시킬 수 있다.

```
 v1 <- 1:5
 v2 <- 6:10
 v1
> [1] 1 2 3 4 5

 v2
> [1]  6  7  8  9 10

 mylist <- list(dataA = v1, dataB = v2) 
 mylist
> $dataA
> [1] 1 2 3 4 5
> 
> $dataB
> [1]  6  7  8  9 10

data.frame(mylist)
>   dataA dataB
> 1     1     6
> 2     2     7
> 3     3     8
> 4     4     9
> 5     5    10

```

A <- rbind (c(1,2,3), c(4,5,6), c(7,8,9))
print(A)
```
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
[3,]    7    8    9
```
B <- cbind (c(1,2,3), c(4,5,6), c(7,8,9))
print(B)
```
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
```

# 3장 데이터 마트

### 데이터 마트

데이터 웨어하우스와 사용자 사이의 중간층에 위치한 것으로 하나의 주제 또는 하나의 부서 중심의 데이터 웨어하우스라고 할 수 있다. 데이터 마트 내 
대부분의 데이터는 데이터 웨어하우스로부터 복제되지만 자체적으로 수집될 수도 있으며, 관계형 데이터 베이스나 다차원 데이터 베이스를 이용하여 구축한다.

 ex) 1개의 데이터워어하우스에서 -> 지역, 고객, 마케팅, 재무, 협력사 데이터마트를 생성한다.

데이터 마트를 만들 때 가장 중요한 것은 데이터웨어하우스에서 받아오는 데이터이다. 받아온 데이터를 처리과정을 통해 분석에 적절하게 활용할 수 있는 자료로 변환해야 한다.


### 요약변수

데이터를 특정 기준에 따라 사칙연산을 통해 만들어 낸 변수로 수집된 정보를 분석에 맞게 종합한 변수이다. 또한 데이터 마트에서 가장 기본적인 변수로 총 구매금액, 금액, 횟수 등 데이터 분석을 위해 만들어지는 변수이다.

요약변수를 잘 만든다면 분석의 중요한 변수로 사용될 수 있고 많은 모델에 공통으로 사용될 수 있어 재활용성이 높다.

예시(기간별 구매금액 및 횟수여부, 위클리쇼퍼, 상품별구매금액 및 횟수여부, 상품별 구매순서, 유통채널별 구매 금액, 단어 빈도, 초기 행동변수, 트렌드변수, 결측값과 이상값 처리, 연속형 변수의 구간화 등)

### 파생변수

사용자의 노하우를 기반으로 새롭게 만들어 낸 변수로 사용자가 특정 조건을 만족하거나 특정 함수에 의해 값을 만들어 의미를 부여한 변수이다. 매우 주관적일 수 잇으므로 논리적 타당성을 갖추어 개발해야 한다.

예시(근무시간 구매지수, 주 구매 매장 변수, 주 활동지역 변수, 주 구매상품 변수, 선호하는 가격대 변수, 시즌 선호고객 변수 등)

- reshape의 활용
    - melt(): 녹이는 함수-> 원데이터 형태로 만드는 함수로 쉬운 casting을 위해 적당한 형태로 만들어주는 함수이다.
    - cast(): 모양을 만드는 함수-> 요약 형태로 만드는 함수로 데이터를 원하는 형태로 계산 또는 변형시켜주는 함수이다.

- sqldf
R에서 sql의 명령어를 사용가능하게 해주는 패키지 이다. (SAS의 PROC SQL과 같은 역할)

- data.table
R에서 가장 많이 사용하는 데이터 핸들링 패키지 중 하나이다. 큰 데이터를 탐색, 연산, 병합하는데 아주 유용하다.
기존 data.frame 방식보다 월등히 빠른 속도이다. 특정 Column을 Key 값으로 색인을 지정한 후 데이터를 처리한다.
빠른 그루핑과 Ordering 짧은 문장지원 측면에서 데이터 프레임보다 유용하다.

### 데이터 가공
head: 시작 6개 record 조회
tail: 마지막 6개 record 조회
summary: 수치형변수(최댓값, 최솟값, 평균, 1사분위수, 2사분위수(중앙값), 3사분위수), 명목형 변수(명목값, 데이터 개수)

### 변수의 구간화
연속형 변수를 분석 목적에 맞게 활용하기 위해 구간화 하여 모델링에 적용한다.

- 변수 구간화 방법
1) Binning : 신용평가 모형의 개발에서 연속형 변수를 범주형 변수로 구간화 하는데 자주 활용되고 있는 방법이다.
2) 의사결정나무: 의사결정나무 모형을 사용하여 입력변수들을 구간화 한다.

### 결측값 처리 방법
- 단순대치법(Single Imputation)
1) Completes Analysis 
결측값이 존재하는 레코드를 삭제한다.

2) 평균대치법(Mean Imputation)
관측 또는 실험을 통해 얻어진 데이터의 평균으로 대치한다.

3) 단순확률 대치법(Single Stochastic Imputation)
평균대치법에서 추정량 표준오차의 과소 추정문제를 보완하고자 고안한 방법

4) 다중 대치법(Multiple Imputation)
단순 대치법을 한 번만 하지 않고 m번의 대치를 통해 m개의 가상적 완전 자료를 만드는 것이다.

### 이상값
이상값은 의도치않게 잘못 입력된 경우, 의도하지 않게 입력되었으나 분석 목적에 부합하지 않아 제거해야하는 경우, 의도하지 않은 형상이지만 분석에 포함해야 하는 경우, 의도된 이상값인 경우 등이 있다.
이상값을 꼭 제거해야 하는 것은 아니기 때문에 종류에 따라 적절한 판단이 필요하다.

### 이상값 인식 방법
1) ESD (Extreme Studentized Deviation)
평균으로부터 3 표준편차 떨어진 값